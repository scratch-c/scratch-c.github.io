<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>草东没有派对随机歌词 API</title>
  <meta http-equiv="Content-Type" content="application/javascript; charset=utf-8">
</head>
<body>
  <script>
    (async function() {
      try {
        // 1. 读取歌词数据源
        const response = await fetch('./lyrics.json');
        if (!response.ok) throw new Error(`读取失败：${response.status}`);
        const lyricsList = await response.json();

        // 2. 随机选一条歌词
        const randomIndex = Math.floor(Math.random() * lyricsList.length);
        const randomLyric = lyricsList[randomIndex];

        // 3. 支持 JSONP 跨域调用（核心：获取回调函数名，返回函数调用）
        const urlParams = new URLSearchParams(window.location.search);
        const callback = urlParams.get('callback') || 'callback'; // 默认回调名
        
        // 输出 JSONP 格式（函数调用包裹 JSON）
        document.body.textContent = `${callback}(${JSON.stringify(randomLyric)})`;

      } catch (error) {
        // 错误处理
        const callback = new URLSearchParams(window.location.search).get('callback') || 'callback';
        document.body.textContent = `${callback}(${JSON.stringify({
          error: true,
          message: error.message,
          data: null
        })})`;
      }
    })();
  </script>
</body>
</html>
